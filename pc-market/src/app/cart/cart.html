@if (cart() !== null) {
  <div class="cart-container">
    <h1>Your Cart</h1>

    @if (message()) {
      <div class="feedback-box">
        <span class="feedback-icon">ℹ️</span>
        <span class="feedback-text">{{ message() }}</span>
      </div>
    }

    <div class="cart-layout">
      <!-- LEFT CONTAINER: PRODUCTS -->
      <div class="cart-box left-box">
        <section class="cart-products">
          <h2>Products</h2>
          <ul>
            @if (cart(); as cart) {
              @if (cart.cartItems.length === 0) {
                <p>You have no items in your cart :c</p>
              } @else {
                @for (item of cart.cartItems; track item.productName) {
                  <li class="cart-product">
                    <!-- IMAGE PLACEHOLDER ADDED -->
                    <div class="product-image-placeholder">
                      <img [src]="item.imageUrl" alt="Product Image" />
                    </div>
                    <div class="product-info">
                      <p class="product-name">{{ item.productName }}</p>
                      <p class="product-seller">Sold by: {{ item.seller }}</p>
                      <p class="product-price">${{ item.price }}</p>
                      <p class="product-quantity">Quantity: {{ item.quantity }}</p>
                    </div>
                    <a class="remove-item" (click)="removeItem(item.cartItemId)">Remove</a>
                  </li>
                }
              }
            }
          </ul>
        </section>
      </div>

      <!-- RIGHT CONTAINER: TOTAL + SHIPPING + PAYMENT + SUBMIT -->
      <div class="cart-box right-box">
        <section class="total-amount">
          <h2>
            Total Amount: <span>${{ totalPrice() }}</span>
          </h2>
        </section>

        <section class="shipping-address">
          <h2 class="centered-title shipping-header">
            Shipping Address
            <button class="edit-button" [routerLink]="'/profile'">Edit</button>
          </h2>

          @if (user(); as u) {
            <div class="form-group">
              <label>Full Name</label>
              <input type="text" [value]="u.first_name + ' ' + u.last_name" readonly />
            </div>

            <div class="form-group">
              <label>Address</label>
              <input type="text" [value]="u.address_1" readonly />
            </div>

            <div class="form-group">
              <label>Apt/Unit</label>
              <input type="text" [value]="u.address_2" readonly />
            </div>

            <div class="form-group">
              <label>State</label>
              <input type="text" [value]="u.state_code" readonly />
            </div>

            <div class="form-group">
              <label>Postal Code</label>
              <input type="text" [value]="u.zip_code" readonly />
            </div>

            <div class="form-group">
              <label>Country</label>
              <input type="text" [value]="u.country_code" readonly />
            </div>
          }
        </section>
        <section class="card-details">
          <!-- CENTERED TITLE -->
          <h2 class="centered-title">Payment Details</h2>
          <div class="form-group">
            <label>Cardholder Name</label>
            <input type="text" placeholder="John Doe" required maxlength="50" />
          </div>
          <div class="form-group">
            <label>Card Number</label>
            <input type="text" placeholder="**** **** **** 1234" required maxlength="19" />
          </div>
          <div class="form-inline">
            <div class="form-group">
              <label>Expiry Date</label>
              <input type="text" placeholder="MM/YY" required maxlength="5" />
            </div>
            <div class="form-group">
              <label>CVV</label>
              <input type="text" placeholder="123" required maxlength="4" />
            </div>
          </div>
        </section>
        <p style="padding: 0; margin: 0">
          <b>NOTE:</b> This is a demo payment form. Do not enter real card details.
        </p>

        @if (cart()?.cartItems?.length === 0) {
          <button class="submit-order-disabled" [disabled]="true">SUBMIT ORDER</button>
        } @else {
          <button class="submit-order" (click)="placeOrder()">SUBMIT ORDER</button>
        }
      </div>
    </div>
  </div>
} @else {
  <div class="loading">
    <div class="spinner"></div>
    <p>Loading cart data...</p>
  </div>
}
